<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Recognition Danmaku</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        #danmaku-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        .danmaku {
            position: absolute;
            white-space: nowrap;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none;
            animation-duration: 10s; /* Danmaku duration */
            animation-timing-function: linear;
            animation-fill-mode: forwards;
        }
        /* Random colors */
        .danmaku.color-1 { color: #ff6b6b; }
        .danmaku.color-2 { color: #4ecdc4; }
        .danmaku.color-3 { color: #45b7d1; }
        .danmaku.color-4 { color: #96ceb4; }
        .danmaku.color-5 { color: #feca57; }
        /* Left to right */
        .danmaku.left-to-right {
            animation-name: leftToRight;
            left: -100%;
            top: var(--start-y);
        }
        @keyframes leftToRight {
            to { left: 100%; }
        }
        /* Right to left */
        .danmaku.right-to-left {
            animation-name: rightToLeft;
            right: -100%;
            top: var(--start-y);
        }
        @keyframes rightToLeft {
            to { right: 100%; }
        }
        /* Top to bottom */
        .danmaku.top-to-bottom {
            animation-name: topToBottom;
            top: -100%;
            left: var(--start-x);
        }
        @keyframes topToBottom {
            to { top: 100%; }
        }
        /* Bottom to top */
        .danmaku.bottom-to-top {
            animation-name: bottomToTop;
            bottom: -100%;
            left: var(--start-x);
        }
        @keyframes bottomToTop {
            to { bottom: 100%; }
        }
        #status {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            color: #fff;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="danmaku-container"></div>
    <div id="status">Listening to speech...</div>

    <script>
        // Check browser support
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            document.getElementById('status').innerText = 'Your browser does not support speech recognition. Please use a modern browser like Chrome.';
            throw new Error('SpeechRecognition not supported');
        }

        const recognition = new SpeechRecognition();
        const container = document.getElementById('danmaku-container');
        const status = document.getElementById('status');

        recognition.continuous = true; // Continuous recognition
        recognition.interimResults = true; // Show interim results
        recognition.lang = 'en-US'; // English recognition

        // Random color array
        const colors = ['color-1', 'color-2', 'color-3', 'color-4', 'color-5'];
        // Random direction array
        const directions = ['left-to-right', 'right-to-left', 'top-to-bottom', 'bottom-to-top'];

        function createDanmaku(text) {
            if (!text || text.trim() === '') return;

            const danmaku = document.createElement('div');
            danmaku.className = `danmaku ${directions[Math.floor(Math.random() * directions.length)]} ${colors[Math.floor(Math.random() * colors.length)]}`;
            danmaku.textContent = text;

            // Random starting position
            if (danmaku.classList.contains('left-to-right') || danmaku.classList.contains('right-to-left')) {
                danmaku.style.setProperty('--start-y', Math.random() * 100 + '%');
            } else {
                danmaku.style.setProperty('--start-x', Math.random() * 100 + '%');
            }

            // Random animation duration (5-15 seconds)
            danmaku.style.animationDuration = (Math.random() * 10 + 5) + 's';

            container.appendChild(danmaku);

            // Remove element after animation ends
            setTimeout(() => {
                if (danmaku.parentNode) {
                    danmaku.parentNode.removeChild(danmaku);
                }
            }, 15000); // Slightly longer than max animation time
        }

        recognition.onresult = function(event) {
            let interimTranscript = '';
            let finalTranscript = '';

            for (let i = event.resultIndex; i < event.results.length; ++i) {
                const result = event.results[i];
                if (result.isFinal) {
                    finalTranscript += result[0].transcript;
                } else {
                    interimTranscript += result[0].transcript;
                }
            }

            // Display final result as danmaku
            if (finalTranscript) {
                createDanmaku(finalTranscript);
                status.innerText = `Recognized: ${finalTranscript}`;
            } else if (interimTranscript) {
                status.innerText = `Temporary: ${interimTranscript}`;
            }
        };

        recognition.onerror = function(event) {
            status.innerText = `Error: ${event.error}`;
            // Auto restart
            setTimeout(() => {
                recognition.start();
            }, 1000);
        };

        recognition.onstart = function() {
            status.innerText = 'Listening to speech...';
        };

        recognition.onend = function() {
            // Auto restart for continuous listening
            setTimeout(() => {
                recognition.start();
            }, 100);
        };

        // Auto start
        recognition.start();
    </script>
</body>
</html>
